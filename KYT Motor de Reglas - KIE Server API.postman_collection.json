{
	"info": {
		"_postman_id": "759d676a-d180-44b6-99c0-91b935ad6697",
		"name": "KYT Motor de Reglas - KIE Server API",
		"description": "Colección para probar el Motor de Reglas KYT en jBPM/KIE Server",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "28338988",
		"_collection_link": "https://test99-9981.postman.co/workspace/BuenBlock~66f350c8-7eb3-4fca-9e70-343bcac74ca3/collection/28338988-759d676a-d180-44b6-99c0-91b935ad6697?action=share&source=collection_link&creator=28338988"
	},
	"item": [
		{
			"name": "1. Gestión de Contenedores",
			"item": [
				{
					"name": "1.1 Listar Contenedores",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.2 Obtener Info de Contenedor",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.3 Crear/Desplegar Contenedor",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"container-id\": \"motor-reglas-kyt_1.0.0\",\n  \"release-id\": {\n    \"group-id\": \"com.myspace\",\n    \"artifact-id\": \"motor-reglas-kyt\",\n    \"version\": \"1.0.0\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "2. Gestión de Procesos",
			"item": [
				{
					"name": "2.1 Listar Definiciones de Procesos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/definitions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"definitions"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.2 Obtener Definición de Proceso",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/definitions/{{process_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"definitions",
								"{{process_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.3 Iniciar Proceso - Persona Natural (Requiere Doc)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set(\"process_instance_id\", jsonData);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"transaccion\": {\n    \"com.myspace.motor_reglas_kyt.Transaccion\": {\n      \"idTransaccion\": \"TRX-20250101-001\",\n      \"montoTransaccion\": 3500.00,\n      \"montoAcumulado\": 8000.00,\n      \"fechaTransaccion\": \"2025-01-15T10:30:00.000-05:00\",\n      \"cliente\": {\n        \"com.myspace.motor_reglas_kyt.Cliente\": {\n          \"tipoClienteBRE\": \"PERSONAS NATURALES GENERAL\",\n          \"tipoClienteFormulario\": \"PERSONA_NATURAL\",\n          \"codigo\": \"CLI-0001\"\n        }\n      }\n    }\n  },\n  \"cliente\": {\n    \"com.myspace.motor_reglas_kyt.Cliente\": {\n      \"tipoClienteBRE\": \"PERSONAS NATURALES GENERAL\",\n      \"tipoClienteFormulario\": \"PERSONA_NATURAL\",\n      \"codigo\": \"CLI-0001\"\n    }\n  },\n  \"documentoVigente\": {\n    \"com.myspace.motor_reglas_kyt.DocumentoOrigenFondos\": {\n      \"idDocumento\": \"DOC-001\",\n      \"fechaFirma\": \"2024-12-01T00:00:00.000-05:00\",\n      \"vigente\": false,\n      \"tipoDocumento\": \"INDIVIDUAL\",\n      \"hashBlockchain\": \"\"\n    }\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/{{process_id}}/instances",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"{{process_id}}",
								"instances"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.4 Iniciar Proceso - Inversionista Calificado",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set(\"process_instance_id\", jsonData);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"transaccion\": {\n    \"com.kyt.modelo.Transaccion\": {\n      \"idTransaccion\": \"TRX-20250101-002\",\n      \"montoTransaccion\": 15000.00,\n      \"montoAcumulado\": 95000.00,\n      \"fechaTransaccion\": \"2025-01-15T11:00:00.000-05:00\",\n      \"cliente\": {\n        \"com.kyt.modelo.Cliente\": {\n          \"tipoClienteBRE\": \"INVERSIONISTAS NATURALES CALIFICADOS\",\n          \"tipoClienteFormulario\": \"INVERSIONISTA_CALIFICADO\",\n          \"codigo\": \"CLI-0002\"\n        }\n      }\n    }\n  },\n  \"cliente\": {\n    \"com.kyt.modelo.Cliente\": {\n      \"tipoClienteBRE\": \"INVERSIONISTAS NATURALES CALIFICADOS\",\n      \"tipoClienteFormulario\": \"INVERSIONISTA_CALIFICADO\",\n      \"codigo\": \"CLI-0002\"\n    }\n  },\n  \"documentoVigente\": {\n    \"com.kyt.modelo.DocumentoOrigenFondos\": {\n      \"idDocumento\": \"DOC-002\",\n      \"fechaFirma\": \"2024-11-01T00:00:00.000-05:00\",\n      \"vigente\": false,\n      \"tipoDocumento\": \"INDIVIDUAL\",\n      \"hashBlockchain\": \"\"\n    }\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/{{process_id}}/instances",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"{{process_id}}",
								"instances"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.5 Iniciar Proceso - Con Documento Vigente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set(\"process_instance_id\", jsonData);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"transaccion\": {\n    \"com.kyt.modelo.Transaccion\": {\n      \"idTransaccion\": \"TRX-20250101-003\",\n      \"montoTransaccion\": 8000.00,\n      \"montoAcumulado\": 45000.00,\n      \"fechaTransaccion\": \"2025-01-15T14:00:00.000-05:00\",\n      \"cliente\": {\n        \"com.kyt.modelo.Cliente\": {\n          \"tipoClienteBRE\": \"PERSONAS NATURALES GENERAL\",\n          \"tipoClienteFormulario\": \"PERSONA_NATURAL\",\n          \"codigo\": \"CLI-0003\"\n        }\n      }\n    }\n  },\n  \"cliente\": {\n    \"com.kyt.modelo.Cliente\": {\n      \"tipoClienteBRE\": \"PERSONAS NATURALES GENERAL\",\n      \"tipoClienteFormulario\": \"PERSONA_NATURAL\",\n      \"codigo\": \"CLI-0003\"\n    }\n  },\n  \"documentoVigente\": {\n    \"com.kyt.modelo.DocumentoOrigenFondos\": {\n      \"idDocumento\": \"DOC-003\",\n      \"fechaFirma\": \"2024-12-15T00:00:00.000-05:00\",\n      \"vigente\": true,\n      \"tipoDocumento\": \"GENERAL\",\n      \"hashBlockchain\": \"0x123abc456def789\"\n    }\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/{{process_id}}/instances",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"{{process_id}}",
								"instances"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "3. Consulta de Instancias de Proceso",
			"item": [
				{
					"name": "3.1 Listar Instancias Activas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/queries/processes/instances?status=1&page=0&pageSize=50",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"queries",
								"processes",
								"instances"
							],
							"query": [
								{
									"key": "status",
									"value": "1",
									"description": "1=Active, 2=Completed, 3=Aborted"
								},
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "pageSize",
									"value": "50"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "3.2 Obtener Instancia Específica",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/queries/processes/instances/{{process_instance_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"queries",
								"processes",
								"instances",
								"{{process_instance_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "3.3 Obtener Variables de Proceso",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/instances/{{process_instance_id}}/variables/instances",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"instances",
								"{{process_instance_id}}",
								"variables",
								"instances"
							]
						}
					},
					"response": []
				},
				{
					"name": "3.4 Abortar Proceso",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/processes/instances/{{process_instance_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"processes",
								"instances",
								"{{process_instance_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "4. Gestión de Tareas",
			"item": [
				{
					"name": "4.1 Listar Tareas de Usuario (Potential Owner)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/queries/tasks/instances/pot-owners?status=Ready&groups=admin,compliance&user={{user}}&page=0&pageSize=50&sortOrder=true",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"queries",
								"tasks",
								"instances",
								"pot-owners"
							],
							"query": [
								{
									"key": "status",
									"value": "Ready",
									"description": "Ready, Reserved, InProgress, Completed"
								},
								{
									"key": "groups",
									"value": "admin,compliance"
								},
								{
									"key": "user",
									"value": "{{user}}"
								},
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "pageSize",
									"value": "50"
								},
								{
									"key": "sortOrder",
									"value": "true"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "4.2 Listar Tareas por Instancia de Proceso",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData['task-summary'] && jsonData['task-summary'].length > 0) {",
									"    pm.collectionVariables.set(\"task_id\", jsonData['task-summary'][0]['task-id']);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/queries/tasks/instances/process/{{process_instance_id}}?status=Ready&status=Reserved&status=InProgress",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"queries",
								"tasks",
								"instances",
								"process",
								"{{process_instance_id}}"
							],
							"query": [
								{
									"key": "status",
									"value": "Ready"
								},
								{
									"key": "status",
									"value": "Reserved"
								},
								{
									"key": "status",
									"value": "InProgress"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "4.3 Obtener Detalles de Tarea",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/tasks/{{task_id}}?withInputData=true&withOutputData=true",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"tasks",
								"{{task_id}}"
							],
							"query": [
								{
									"key": "withInputData",
									"value": "true"
								},
								{
									"key": "withOutputData",
									"value": "true"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "4.4 Reclamar Tarea (Claim)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/tasks/{{task_id}}/states/claimed?user={{user}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"tasks",
								"{{task_id}}",
								"states",
								"claimed"
							],
							"query": [
								{
									"key": "user",
									"value": "{{user}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "4.5 Iniciar Tarea (Start)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/tasks/{{task_id}}/states/started?user={{user}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"tasks",
								"{{task_id}}",
								"states",
								"started"
							],
							"query": [
								{
									"key": "user",
									"value": "{{user}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "4.6 Completar Tarea con Documento",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"documentoCompletado\": {\n    \"com.kyt.modelo.DocumentoOrigenFondos\": {\n      \"idDocumento\": \"DOC-NEW-001\",\n      \"fechaFirma\": \"2025-01-15T10:00:00.000-05:00\",\n      \"vigente\": true,\n      \"tipoDocumento\": \"INDIVIDUAL\",\n      \"hashBlockchain\": \"0xABC123DEF456789GHI\"\n    }\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/tasks/{{task_id}}/states/completed?user={{user}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"tasks",
								"{{task_id}}",
								"states",
								"completed"
							],
							"query": [
								{
									"key": "user",
									"value": "{{user}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "4.7 Liberar Tarea (Release)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}/tasks/{{task_id}}/states/released?user={{user}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}",
								"tasks",
								"{{task_id}}",
								"states",
								"released"
							],
							"query": [
								{
									"key": "user",
									"value": "{{user}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "5. Ejecución de Reglas",
			"item": [
				{
					"name": "5.1 Ejecutar Reglas - Validación Monto Individual",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"lookup\": \"defaultStatelessKieSession\",\n  \"commands\": [\n    {\n      \"insert\": {\n        \"object\": {\n          \"com.kyt.modelo.Cliente\": {\n            \"tipoClienteBRE\": \"PERSONAS NATURALES GENERAL\",\n            \"tipoClienteFormulario\": \"PERSONA_NATURAL\",\n            \"codigo\": \"CLI-TEST-001\"\n          }\n        },\n        \"out-identifier\": \"cliente\"\n      }\n    },\n    {\n      \"insert\": {\n        \"object\": {\n          \"com.kyt.modelo.Transaccion\": {\n            \"idTransaccion\": \"TRX-TEST-001\",\n            \"montoTransaccion\": 2500.00,\n            \"montoAcumulado\": 5000.00,\n            \"fechaTransaccion\": \"2025-01-15T10:00:00.000-05:00\"\n          }\n        },\n        \"out-identifier\": \"transaccion\"\n      }\n    },\n    {\n      \"insert\": {\n        \"object\": {\n          \"com.kyt.modelo.ResultadoValidacion\": {}\n        },\n        \"out-identifier\": \"resultado\"\n      }\n    },\n    {\n      \"fire-all-rules\": {\n        \"max\": -1,\n        \"out-identifier\": \"firedActivations\"\n      }\n    },\n    {\n      \"get-objects\": {\n        \"out-identifier\": \"objects\"\n      }\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/containers/{{container_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"containers",
								"{{container_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "6. Flujo Completo Automatizado",
			"item": [
				{
					"name": "6.1 Workflow Completo - Claim, Start, Complete",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Este script asume que ya tienes process_instance_id y task_id en las variables"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "// Nota: Postman no soporta múltiples requests en uno.\n// Usa Postman Runner o Newman para ejecutar secuencialmente:\n// 1. 4.4 Reclamar Tarea\n// 2. 4.5 Iniciar Tarea\n// 3. 4.6 Completar Tarea"
						},
						"url": {
							"raw": ""
						}
					},
					"response": []
				}
			]
		}
	],
	"auth": {
		"type": "basic",
		"basic": [
			{
				"key": "password",
				"value": "wbadmin",
				"type": "string"
			},
			{
				"key": "username",
				"value": "wbadmin",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080/kie-server/services/rest/server"
		},
		{
			"key": "container_id",
			"value": "motor-reglas-kyt_1.0.0"
		},
		{
			"key": "process_id",
			"value": "motor-reglas-kyt.ProcesoValidacionKYT"
		},
		{
			"key": "process_instance_id",
			"value": ""
		},
		{
			"key": "task_id",
			"value": ""
		},
		{
			"key": "user",
			"value": "admin"
		}
	]
}